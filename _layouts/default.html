<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    {% if page.title %}
      {{ page.title }} · {{ site.title }}
    {% else %}
      {{ site.title }} — {{ site.description }}
    {% endif %}
  </title>

  <!-- Meta description: page.description > page.excerpt > site.description -->
  <meta name="description"
        content="{{ page.description | default: page.excerpt | default: site.description | strip_html | strip_newlines | truncate: 160 }}" />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0b0b" />
  <meta name="color-scheme" content="dark light" />

  <!-- Canonical (respeita baseurl) -->
  <link rel="canonical" href="{{ page.url | relative_url | absolute_url }}" />

  <!-- CSS principal -->
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}"/>

  <!-- Favicons / PWA -->
  <link rel="icon" type="image/png" sizes="32x32" href="{{ '/assets/img/favicon-32.png' | relative_url }}">
  <link rel="icon" type="image/png" sizes="192x192" href="{{ '/assets/img/favicon-192.png' | relative_url }}">
  <link rel="apple-touch-icon" href="{{ '/assets/img/apple-touch-icon.png' | relative_url }}">
  <link rel="manifest" href="{{ '/manifest.webmanifest' | relative_url }}">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="{{ site.title }}">
  <meta property="og:title" content="{{ page.title | default: site.title }}">
  <meta property="og:description" content="{{ page.description | default: page.excerpt | default: site.description | strip_html | strip_newlines | truncate: 180 }}">
  <meta property="og:url" content="{{ page.url | relative_url | absolute_url }}">
  <meta property="og:image" content="{{ page.image | default: site.og_image | default: '/assets/img/og-default.jpg' | relative_url | absolute_url }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page.title | default: site.title }}">
  <meta name="twitter:description" content="{{ page.description | default: page.excerpt | default: site.description | strip_html | strip_newlines | truncate: 180 }}">
  <meta name="twitter:image" content="{{ page.image | default: site.og_image | default: '/assets/img/og-default.jpg' | relative_url | absolute_url }}">

  <!-- JSON-LD: WebSite -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"{{ site.title }}",
    "url":"{{ '/' | absolute_url }}",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"{{ '/utilitarios/?q=' | absolute_url }}{% raw %}{search_term_string}{% endraw %}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <!-- JSON-LD: Person -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Person",
    "name":"Márcio Dowglas Personal Trainer",
    "url":"{{ '/' | absolute_url }}",
    "sameAs":[
      "https://instagram.com/marciodowglasfitness",
      "https://youtube.com/@marciodowglastreinador",
      "https://youtube.com/@centrodeneurotreinamento"
    ]
  }
  </script>

  <!-- GA4 (opcional) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.ga4_id | default: 'G-XXXXXXX' }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config','{{ site.ga4_id | default: "G-XXXXXXX" }}');
  </script>
</head>
<body class="{{ page.body_class }}">
  <!-- Header -->
  <header class="site-header">
    <nav class="main-nav">
      <a href="{{ '/' | relative_url }}">Início</a>
      <a href="{{ '/blog/' | relative_url }}">Blog</a>
      <a href="{{ '/utilitarios/' | relative_url }}">Utilitários</a>
      <a href="{{ '/about/' | relative_url }}">Sobre</a>
    </nav>
  </header>

  <!-- Banner de instalação PWA (fica oculto até o JS ativar) -->
  <div id="pwa-install" hidden>
    <div class="pwa-bar">
      <div class="pwa-left">
        <img src="{{ '/assets/img/icons/icon-192.png' | relative_url }}" alt="Ícone do MD Personal" width="40" height="40" loading="lazy" decoding="async">
        <div>
          <strong>Instalar o app do MD Personal?</strong>
          <small>Receba os posts mais rápido e acesse offline.</small>
        </div>
      </div>
      <div class="pwa-actions">
        <button class="pwa-btn pwa-later">Depois</button>
        <button class="pwa-btn pwa-install">Instalar</button>
      </div>
    </div>
  </div>

  <main>
    {{ content }}
  </main>

  <footer class="site-footer">
    <p>© Márcio Dowglas Personal Trainer — {{ site.time | date: '%Y' }}</p>
    <p class="social">
      <a href="https://www.instagram.com/marciodowglasfitness" target="_blank" rel="noopener">@marciodowglasfitness</a> ·
      <a href="https://youtube.com/@marciodowglastreinador" target="_blank" rel="noopener">@marciodowglastreinador</a> ·
      <a href="https://youtube.com/@centrodeneurotreinamento" target="_blank" rel="noopener">@centrodeneurotreinamento</a>
    </p>
  </footer>

  <!-- JS global -->
  <script>
    // Marca cliques de afiliado e CTA
    document.addEventListener('click', function(e){
      const a = e.target.closest('a');
      if(!a) return;

      // Afiliados
      if (a.href.includes('shopee.com') || a.href.includes('fithouse.com')) {
        const parceiro = a.href.includes('shopee.com') ? 'Shopee' : 'FitHouse';
        if (typeof gtag === 'function') {
          gtag('event', 'click_afiliado', { event_category:'Afiliado', event_label: parceiro, value:1 });
        }
        a.setAttribute('rel','nofollow sponsored noopener');
      }

      // CTA avaliação
      if (a.classList.contains('destaque') || a.href.includes('/avaliacao')) {
        if (typeof gtag === 'function') {
          gtag('event', 'click_cta_avaliacao', { event_category:'CTA', event_label:'Avaliacao gratuita', value:1 });
        }
      }
    });

    // Defer de data-bg
    window.addEventListener('load', function(){
      document.querySelectorAll('[data-bg]').forEach(function(el){
        const url = el.getAttribute('data-bg');
        if (url) el.style.backgroundImage = 'url(' + url + ')';
      });
    });
  </script>

  <!-- PWA: lógica do banner + install prompt -->
  <script src="{{ '/assets/js/pwa.js' | relative_url }}" defer></script>
</body>
</html>
